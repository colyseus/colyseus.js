{"version":3,"file":"Storage.js","sources":["../../src/Storage.ts"],"sourcesContent":["/// <reference path=\"../typings/cocos-creator.d.ts\" />\r\n\r\n/**\r\n * We do not assign 'storage' to window.localStorage immediatelly for React\r\n * Native compatibility. window.localStorage is not present when this module is\r\n * loaded.\r\n */\r\n\r\nlet storage: any;\r\n\r\nfunction getStorage(): Storage {\r\n    if (!storage)  {\r\n        try {\r\n            storage = (typeof (cc) !== 'undefined' && cc.sys && cc.sys.localStorage)\r\n                ? cc.sys.localStorage  // compatibility with cocos creator\r\n                : window.localStorage; // RN does have window object at this point, but localStorage is not defined\r\n\r\n        } catch (e) {\r\n            // ignore error\r\n        }\r\n    }\r\n\r\n    if (!storage) {\r\n        // mock localStorage if not available (Node.js or RN environment)\r\n        storage = {\r\n            cache: {},\r\n            setItem: function (key, value) { this.cache[key] = value; },\r\n            getItem: function (key) { this.cache[key]; },\r\n            removeItem: function (key) { delete this.cache[key]; },\r\n        };\r\n    }\r\n\r\n    return storage;\r\n}\r\n\r\nexport function setItem(key: string, value: string) {\r\n    getStorage().setItem(key, value);\r\n}\r\n\r\nexport function removeItem(key: string) {\r\n    getStorage().removeItem(key);\r\n}\r\n\r\nexport function getItem(key: string, callback: Function) {\r\n    const value: any = getStorage().getItem(key);\r\n\r\n    if (\r\n        typeof (Promise) === 'undefined' || // old browsers\r\n        !(value instanceof Promise)\r\n    ) {\r\n        // browser has synchronous return\r\n        callback(value);\r\n\r\n    } else {\r\n        // react-native is asynchronous\r\n        value.then((id) => callback(id));\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;AAIG;AAEH,IAAI,OAAY,CAAC;AAEjB,SAAS,UAAU,GAAA;IACf,IAAI,CAAC,OAAO,EAAG;AACX,QAAA,IAAI;AACA,YAAA,OAAO,GAAG,CAAC,QAAQ,EAAE,CAAC,KAAK,WAAW,IAAI,EAAE,CAAC,GAAG,IAAI,EAAE,CAAC,GAAG,CAAC,YAAY;AACnE,kBAAE,EAAE,CAAC,GAAG,CAAC,YAAY;AACrB,kBAAE,MAAM,CAAC,YAAY,CAAC;SAE7B;QAAC,OAAO,CAAC,EAAE;;SAEX;KACJ;IAED,IAAI,CAAC,OAAO,EAAE;;AAEV,QAAA,OAAO,GAAG;AACN,YAAA,KAAK,EAAE,EAAE;AACT,YAAA,OAAO,EAAE,UAAU,GAAG,EAAE,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,EAAE;AAC3D,YAAA,OAAO,EAAE,UAAU,GAAG,EAAA,EAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE;AAC5C,YAAA,UAAU,EAAE,UAAU,GAAG,EAAA,EAAI,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE;SACzD,CAAC;KACL;AAED,IAAA,OAAO,OAAO,CAAC;AACnB,CAAC;AAEe,SAAA,OAAO,CAAC,GAAW,EAAE,KAAa,EAAA;IAC9C,UAAU,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;AACrC,CAAC;AAEK,SAAU,UAAU,CAAC,GAAW,EAAA;AAClC,IAAA,UAAU,EAAE,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;AACjC,CAAC;AAEe,SAAA,OAAO,CAAC,GAAW,EAAE,QAAkB,EAAA;IACnD,IAAM,KAAK,GAAQ,UAAU,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AAE7C,IAAA,IACI,QAAQ,OAAO,CAAC,KAAK,WAAW;AAChC,QAAA,EAAE,KAAK,YAAY,OAAO,CAAC,EAC7B;;QAEE,QAAQ,CAAC,KAAK,CAAC,CAAC;KAEnB;SAAM;;AAEH,QAAA,KAAK,CAAC,IAAI,CAAC,UAAC,EAAE,EAAK,EAAA,OAAA,QAAQ,CAAC,EAAE,CAAC,CAAZ,EAAY,CAAC,CAAC;KACpC;AACL;;;;;;"}