{"version":3,"file":"HTTP.js","sources":["../../src/HTTP.ts"],"sourcesContent":["import { Client } from \"./Client\";\r\nimport { ServerError } from \"./errors/ServerError\";\r\nimport * as httpie from \"httpie\";\r\n\r\nexport class HTTP {\r\n    public authToken: string;\r\n\r\n    constructor(protected client: Client) {}\r\n\r\n    public get<T = any>(path: string, options: Partial<httpie.Options> = {}): Promise<httpie.Response<T>> {\r\n        return this.request(\"get\", path, options);\r\n    }\r\n\r\n    public post<T = any>(path: string, options: Partial<httpie.Options> = {}): Promise<httpie.Response<T>> {\r\n        return this.request(\"post\", path, options);\r\n    }\r\n\r\n    public del<T = any>(path: string, options: Partial<httpie.Options> = {}): Promise<httpie.Response<T>> {\r\n        return this.request(\"del\", path, options);\r\n    }\r\n\r\n    public put<T = any>(path: string, options: Partial<httpie.Options> = {}): Promise<httpie.Response<T>> {\r\n        return this.request(\"put\", path, options);\r\n    }\r\n\r\n    protected request(method: \"get\" | \"post\" | \"put\" | \"del\", path: string, options: Partial<httpie.Options> = {}): Promise<httpie.Response> {\r\n        return httpie[method](this.client['getHttpEndpoint'](path), this.getOptions(options)).catch((e: any) => {\r\n            const status = e.statusCode; //  || -1\r\n            const message = e.data?.error || e.statusMessage || e.message; //  || \"offline\"\r\n\r\n            if (!status && !message) {\r\n                throw e;\r\n            }\r\n\r\n            throw new ServerError(status, message);\r\n        });\r\n    }\r\n\r\n    protected getOptions(options: Partial<httpie.Options>) {\r\n        if (this.authToken) {\r\n            if (!options.headers) {\r\n                options.headers = {};\r\n            }\r\n\r\n            options.headers['Authorization'] = `Bearer ${this.authToken}`;\r\n        }\r\n\r\n        if (typeof (cc) !== 'undefined' && cc.sys && cc.sys.isNative) {\r\n            //\r\n            // Workaround for Cocos Creator on Native platform\r\n            // \"Cannot set property withCredentials of #<XMLHttpRequest> which has only a getter\"\r\n            //\r\n        } else {\r\n            // always include credentials\r\n            options.withCredentials = true;\r\n        }\r\n\r\n        return options;\r\n    }\r\n}\r\n"],"names":["httpie","ServerError"],"mappings":"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"}